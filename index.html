<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For Keira v20</title>

  <!-- Cute friendly fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- background hearts -->
  <svg class="bg-hearts" viewBox="0 0 1200 800" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <pattern id="bgheart" width="90" height="90" patternUnits="userSpaceOnUse">
        <path d="M45 62 C30 50, 18 40, 18 28 C18 18, 26 10, 36 10 C42 10, 47 13, 45 18 C43 13, 48 10, 54 10 C64 10, 72 18, 72 28 C72 40, 60 50, 45 62 Z"
              fill="rgba(255,255,255,0.55)"/>
      </pattern>
    </defs>
    <rect width="1200" height="800" fill="url(#bgheart)"/>
  </svg>

  <div class="wrap">
    <!-- GATE -->
    <section id="gateCard" class="card hidden">
      <div class="header">
        <div class="badge"><span class="dot"></span><span id="gateStatus">SEALED</span></div>
        <div id="gateTapHint" class="tapHint">Tap to open me</div>
      </div>

      <div id="gate" class="gate">
        <div class="gateInner">
          <div class="gateTitle">
            <h1 id="gateTitle">Open me tomorrow</h1>
            <p id="gateSub">This unlocks on Valentineâ€™s Day</p>
          </div>

          <div class="envelopeWrap">
            <div id="envelope" class="envelope" aria-hidden="true">
              <div class="pocket"></div>
              <div class="flapLeft"></div>
              <div class="flapRight"></div>
              <div class="flapTop"></div>

              <div class="seal">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 21.35
                            C10.55 20.03, 4 15.36, 4 10.5
                            C4 7.42, 6.42 5, 9.5 5
                            C11.24 5, 12 6.09, 12 6.09
                            C12 6.09, 12.76 5, 14.5 5
                            C17.58 5, 20 7.42, 20 10.5
                            C20 15.36, 13.45 20.03, 12 21.35 Z"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="countRow">
            <div class="countCard">
              <div class="label">Unlocks in</div>
              <div id="countdown" class="value">â€”</div>
              <div class="note">Brisbane time</div>
            </div>
          </div>
        </div>

        <div class="continue"><span>Tap anywhere</span></div>
      </div>
    </section>

    <!-- APP -->
    <section id="appCard" class="card hidden">
      <div class="header">
        <div class="badge"><span class="dot"></span><span id="stepLabel">STEP 1</span></div>
        <div id="appTapHint" class="tapHint show">Tap to continue</div>
      </div>

      <!-- STEP 1: PHOTOS -->
      <div id="step1" class="step hidden">
        <div class="stepInner">
          <h2 class="title">A few favourite moments</h2>
          <p class="subtitle">I keep these in my head all the time</p>

          <div class="grid" id="photoGrid"></div>
        </div>
        <div class="continue"><span>Tap to continue</span></div>
      </div>

      <!-- STEP 2: LISTS -->
      <div id="step2" class="step hidden">
        <div class="stepInner">
          <h2 class="title">Things I love about you</h2>
          <p class="subtitle">And the tiny moments that make me smile</p>

          <div class="split">
            <div class="note">
              <h3>Things I love about you</h3>
              <ul id="loveList"></ul>
            </div>
            <div class="note">
              <h3>Favourite tiny moments</h3>
              <ul id="tinyList"></ul>
            </div>
          </div>
        </div>
        <div class="continue"><span>Tap to continue</span></div>
      </div>

      <!-- STEP 3: QUESTION -->
      <div id="step3" class="step hidden">
        <div class="stepInner">
          <h2 class="title">Important Question</h2>
          <p class="subtitle">Please answer carefully</p>

          <div class="questionBox">
            <div class="qText" id="qText">Will you be my Valentine?</div>
            <div class="qSub" id="qSub">No wrong answersâ€¦ except one.</div>

            <div class="buttons" id="btnArea">
              <button id="yesBtn" class="btn btnYes" type="button">Yes</button>
              <button id="noBtn" class="btn btnNo" type="button">No</button>
            </div>

            <div class="funny" id="funnyLine"></div>

            <div id="final" class="finalMessage hidden">
              <h2>I love you</h2>
              <p>Best answer ever. Happy Valentineâ€™s Day ðŸ’— â€” Sam</p>
            </div>
          </div>
        </div>
        <div class="continue"><span>Tap anywhere (or press a button)</span></div>
      </div>

      <audio id="song" src="audio/song.mp3" preload="auto"></audio>
    </section>
  </div>

  <script>
    // =========================================================
    // CONFIG YOU EDIT
    // =========================================================
    // Brisbane time
    const UNLOCK_AT = new Date("2026-02-14T00:00:00+10:00");

    // Photos: put files in /photos/ and update captions
    const PHOTOS = [
      { src: "photos/01.jpg", cap: "All the many nights we spent at Wellington Point" },
      { src: "photos/02.jpg", cap: "All the fantastic adventures I've had with you" },
      { src: "photos/03.jpg", cap: "Your unending support for me" },
      { src: "photos/04.jpg", cap: "The first day of our journey together" },
    ];

    const LOVE_THINGS = [
      "You'pretty funny sometimes I guess or something",
      "You're pretty pretty ;)",
      "You're wacky, smart, crazy little squishy brain",
      "The way you love others",
      "How driven you are in every facet of your life",
    ];

    const TINY_MOMENTS = [
      "The wellington point burrito under the rain",
      "Star gazing and naming new star constelations (remember squish?).",
      "FAMILY KISS.",
      "The horiffic proposal that we'll never forget.",
      "When we adopted Mr. Potato :(",
    ];

    // Funny lines for the "No" button
    const NO_LINES = [
        "Oh... I think you misclicked. Let's try that again.",
        "How odd. Almost like you're trying to say no on purpose...",
        "Woah. How'd that no button get over there? (it wasn't me)",
        "Is it just me or is that â€˜Yesâ€™ button looking big and juicy?",
        "Ok itâ€™s not funny anymore. Iâ€™m about to cry.",
        "Youâ€™re right, married people should have to do this.",
        "Ok now itâ€™s just awkward.",
        "I think ur device is broken.",
        "Final offer: you click yes and Iâ€™ll give you a foot rub."
    ];

    // Hidden bypass key for testing (not shown)
    const BYPASS_KEY = "/";

    // =========================================================
    // ELEMENTS
    // =========================================================
    const gateCard = document.getElementById("gateCard");
    const gate = document.getElementById("gate");
    const envelope = document.getElementById("envelope");
    const countdownEl = document.getElementById("countdown");
    const gateStatus = document.getElementById("gateStatus");
    const gateTapHint = document.getElementById("gateTapHint");
    const gateTitle = document.getElementById("gateTitle");
    const gateSub = document.getElementById("gateSub");

    const appCard = document.getElementById("appCard");
    const appTapHint = document.getElementById("appTapHint");
    const stepLabel = document.getElementById("stepLabel");

    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");

    const photoGrid = document.getElementById("photoGrid");
    const loveList = document.getElementById("loveList");
    const tinyList = document.getElementById("tinyList");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const btnArea = document.getElementById("btnArea");
    const funnyLine = document.getElementById("funnyLine");
    const finalBox = document.getElementById("final");
    const song = document.getElementById("song");

    let noHoverDodgedOnce = false;
    let tapCount = 0;
    let tapTimer = null;

    noBtn.addEventListener("mouseenter", () => {
        // Only on the 4th No, and only once
        if (noCount === 4 && !noHoverDodgedOnce) {
            noHoverDodgedOnce = true;
            moveNoButton();
        }
        });

    gate.addEventListener("touchstart", () => {

        tapCount++;

        clearTimeout(tapTimer);

        tapTimer = setTimeout(() => {
            tapCount = 0;
        }, 500);   // tap window

        if (tapCount === 3) {
            enableBypass();
            tapCount = 0;
        }
        });
    // =========================================================
    // RENDER CONTENT
    // =========================================================
    function renderPhotos(){
      photoGrid.innerHTML = PHOTOS.map(p => `
        <figure class="mem">
          <img src="${p.src}" alt="Memory" loading="lazy" />
          <figcaption>${escapeHtml(p.cap)}</figcaption>
        </figure>
      `).join("");
    }

    function renderLists(){
      loveList.innerHTML = LOVE_THINGS.map(x => `<li>${escapeHtml(x)}</li>`).join("");
      tinyList.innerHTML = TINY_MOMENTS.map(x => `<li>${escapeHtml(x)}</li>`).join("");
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    renderPhotos();
    renderLists();

    // =========================================================
    // TIME GATE
    // =========================================================
    function pad(n){ return String(n).padStart(2,"0"); }

    let unlocked = false;

    function updateCountdown(){
      const t = UNLOCK_AT - new Date();
      if (t <= 0) {
        unlocked = true;
        countdownEl.textContent = "Ready now";
        gateCard.classList.remove("hidden");
        gate.classList.add("unlocked");
        gateStatus.textContent = "UNLOCKED";
        gateTapHint.classList.add("show");
        gateTitle.textContent = "Open me";
        gateSub.textContent = "Tap to open your letter";
        return;
      }

      const s = Math.floor(t/1000);
      const d = Math.floor(s/86400);
      const h = Math.floor((s%86400)/3600);
      const m = Math.floor((s%3600)/60);
      const sec = s%60;

      countdownEl.textContent = `${d}d ${pad(h)}:${pad(m)}:${pad(sec)}`;
      setTimeout(updateCountdown, 250);
    }

    function showGate(){
      gateCard.classList.remove("hidden");
      appCard.classList.add("hidden");
      updateCountdown();
    }

    function showApp(){
      gateCard.classList.add("hidden");
      appCard.classList.remove("hidden");
      goToStep(1);
    }

    // Hidden bypass for you testing
    function enableBypass(){
      unlocked = true;
      try { sessionStorage.setItem("val_bypass","1"); } catch(_){}
      // Update gate UI immediately
      countdownEl.textContent = "Ready now";
      gate.classList.add("unlocked");
      gateStatus.textContent = "UNLOCKED";
      gateTapHint.classList.add("show");
      gateTitle.textContent = "Open me";
      gateSub.textContent = "Tap to open your letter";
    }

    document.addEventListener("keydown", (e)=>{
      if (e.key === BYPASS_KEY) enableBypass();
    });

    const bypassed = (() => {
      try { return sessionStorage.getItem("val_bypass") === "1"; } catch(_) { return false; }
    })();

    // Start
    showGate();
    if (bypassed) enableBypass();

    // Gate tap behavior:
    // - if locked: do nothing (just cute)
    // - if unlocked: open app
    gate.addEventListener("click", () => {
      if (!unlocked) return;
      // small â€œopenâ€ animation moment
      envelope.style.transform = "translateY(-1px)";
      setTimeout(() => {
        envelope.style.transform = "";
        showApp();
      }, 140);
    });

    // =========================================================
    // STEP FLOW (tap anywhere in card to continue)
    // =========================================================
    let currentStep = 1;

    function goToStep(n){
        currentStep = n;

        // Hide all
        step1.classList.add("hidden");
        step2.classList.add("hidden");
        step3.classList.add("hidden");

        if (n === 1){
            stepLabel.textContent = "STEP 1";
            step1.classList.remove("hidden");
            return;
        }

        if (n === 2){
            stepLabel.textContent = "STEP 2";
            step2.classList.remove("hidden");
            return;
        }

        // STEP 3 init (Question)
        stepLabel.textContent = "STEP 3";
        step3.classList.remove("hidden");

        // reset state
        noCount = 0;
        noHoverDodgedOnce = false;
        funnyLine.textContent = "";
        finalBox.classList.add("hidden");

        noBtn.disabled = false;
        noBtn.style.opacity = "";
        noBtn.style.cursor = "";

        // IMPORTANT: do NOT force absolute positioning anymore
        yesBtn.style.position = "";
        yesBtn.style.left = "";
        yesBtn.style.top = "";
        yesBtn.style.transform = "scale(1)";
        yesBtn.classList.remove("juicy");
        yesBtn.style.setProperty("--yesScale", 1);

        noBtn.style.position = "";
        noBtn.style.left = "";
        noBtn.style.top = "";
        noBtn.style.transform = "scale(1)";

        // If the layout is still settling (fonts/images), re-apply once on next frame
        requestAnimationFrame(() => {
            yesBtn.style.transform = "translate(-50%, -50%) scale(1)";
            noBtn.style.transform  = "translate(-50%, -50%) scale(1)";
        });
    }

    // Tap anywhere in the app card advances (except when clicking buttons)
    appCard.addEventListener("click", (e) => {
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      if (tag === "button") return; // don't advance when pressing Yes/No
      if (currentStep < 3) goToStep(currentStep + 1);
    });

    // =========================================================
    // MARRY ME BUTTON LOGIC
    // =========================================================
    let noCount = 0;

    function setButtonScales(){

        /* YES grows until 7 No clicks */
        const cappedNo = Math.min(noCount, 7);

        const yesScale = 1 + cappedNo * 0.18;   // stronger growth
        const noScale  = Math.max(1 - cappedNo * 0.10, 0.50);

        yesBtn.style.transform = `scale(${yesScale})`;
        noBtn.style.transform  = `scale(${noScale})`;

        // keep juicy in sync
        yesBtn.style.setProperty("--yesScale", yesScale);

        if (noCount >= 3) yesBtn.classList.add("juicy");
    }

    function rectsOverlap(a, b) {
        return !(
            a.right  <= b.left  ||
            a.left   >= b.right ||
            a.bottom <= b.top   ||
            a.top    >= b.bottom
        );
    }

    function moveNoButton() {
        // Ensure absolute positioning inside arena
        noBtn.style.position = "absolute";

        const arenaRect = btnArea.getBoundingClientRect();

        // Get No button size (including current scale)
        const noRect = noBtn.getBoundingClientRect();
        const noW = noRect.width;
        const noH = noRect.height;

        // Yes rect (viewport coords) for overlap check
        const yesRect = yesBtn.getBoundingClientRect();

        const margin = 10;

        // Arena-local max ranges (NOT viewport)
        const maxX = Math.max(0, btnArea.clientWidth  - noW);
        const maxY = Math.max(0, btnArea.clientHeight - noH);

        // Try multiple random spots that don't overlap the YES
        for (let i = 0; i < 30; i++) {
            let x = Math.random() * maxX;
            let y = Math.random() * maxY;

            x = Math.max(margin, Math.min(x, maxX - margin));
            y = Math.max(margin, Math.min(y, maxY - margin));

            // Convert candidate position to viewport rect for overlap test
            const candidate = {
            left: arenaRect.left + x,
            top: arenaRect.top + y,
            right: arenaRect.left + x + noW,
            bottom: arenaRect.top + y + noH
            };

            if (!rectsOverlap(candidate, yesRect)) {
            noBtn.style.left = x + "px";
            noBtn.style.top  = y + "px";
            return;
            }
        }

        // Fallback: bottom-right-ish but still inside
        noBtn.style.left = Math.max(margin, maxX - margin) + "px";
        noBtn.style.top  = Math.max(margin, maxY - margin) + "px";
    }

    noBtn.addEventListener("click", () => {
      noCount++;
      funnyLine.textContent = NO_LINES[Math.min(noCount - 1, NO_LINES.length - 1)];
      setButtonScales();

      // After a couple of "No"s, it gets evasive
      if (noCount >= 3) moveNoButton();

      // Tiny shake
        noBtn.animate(
        [
            { transform: "translateX(0px)" },
            { transform: "translateX(6px)" },
            { transform: "translateX(-6px)" },
            { transform: "translateX(0px)" },
        ],
        { duration: 220, iterations: 1, composite: "add" }
        );
    });

    yesBtn.addEventListener("click", async () => {
      funnyLine.textContent = "";
      finalBox.classList.remove("hidden");
      burstHearts();

      // Play song (works because this is a user click)
      try { await song.play(); } catch (_) {}

      // Make "No" stop being annoying
      noBtn.disabled = true;
      noBtn.style.opacity = "0.35";
      noBtn.style.cursor = "default";
    });

    // =========================================================
    // HEART CONFETTI
    // =========================================================
    function burstHearts(){
        const COUNT = 120;                 // was ~34
        const LIFETIME_MS = 9000;          // how long they exist
        const MIN_DUR = 3.5;               // seconds
        const MAX_DUR = 6.8;               // seconds

        for (let i = 0; i < COUNT; i++){
            const s = document.createElement("span");
            s.className = "confetti";
            s.style.left = (Math.random() * 100) + "vw";

            // random fall duration (longer)
            const dur = MIN_DUR + Math.random() * (MAX_DUR - MIN_DUR);
            s.style.animationDuration = dur + "s";

            // random size variety (nice touch)
            const size = 14 + Math.random() * 18; // 14..32px
            s.style.width = size + "px";
            s.style.height = size + "px";

            // random starting rotation
            s.style.transform = `translateY(0) rotate(${Math.floor(Math.random()*180)}deg)`;

            s.innerHTML = `
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 21.35
                        C10.55 20.03, 4 15.36, 4 10.5
                        C4 7.42, 6.42 5, 9.5 5
                        C11.24 5, 12 6.09, 12 6.09
                        C12 6.09, 12.76 5, 14.5 5
                        C17.58 5, 20 7.42, 20 10.5
                        C20 15.36, 13.45 20.03, 12 21.35 Z"/>
            </svg>`;

            document.body.appendChild(s);
            setTimeout(() => s.remove(), LIFETIME_MS);
        }
    }
    // keira. you suck at coding but i love you <3
  </script>
</body>
</html>